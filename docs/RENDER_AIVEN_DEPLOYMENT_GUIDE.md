# ShareAMeal Deployment Guide: Render + Aiven (100% FREE)

## üéØ Overview

Deploy ShareAMeal backend using:

- **Render** (FREE - Web Service)
- **Aiven** (FREE - MySQL Database)

**Total Cost: $0/month forever**

---

## üìã Prerequisites

- GitHub account
- Render account (sign up free)
- Aiven account (sign up free)
- Your ShareAMeal code pushed to GitHub

---

## ‚è±Ô∏è Deployment Timeline

Total time: **~20 minutes**

1. **Aiven MySQL Setup** (8 min)
2. **Push Code to GitHub** (3 min)
3. **Render Web Service** (7 min)
4. **Test Deployment** (2 min)

---

## PART 1: Set Up Aiven MySQL Database (8 min)

### Step 1: Create Aiven Account

1. Go to **https://aiven.io**
2. Click **Sign Up Free**
3. Use Google/GitHub login or email
4. No credit card required initially

### Step 2: Create MySQL Service

1. After login, click **+ Create Service**
2. Select **MySQL**
3. Choose plan:
   - **Startup-4** (FREE tier)
   - 1GB storage, 1 CPU
4. Select cloud:
   - Choose **AWS**
   - Region: **us-east-1** (closest to Render)
5. Service name: `shareameal-mysql`
6. Click **Create Service**
7. Wait 2-3 minutes for provisioning

### Step 3: Get Connection Details

Once service is running (green status):

1. Click on your service `shareameal-mysql`
2. Go to **Connection information** tab
3. Note down (copy to notepad):
   ```
   Host:     <your-service>.aivencloud.com
   Port:     <typically 3306>
   User:     avnadmin
   Password: <long-password>
   Database: defaultdb
   ```

### Step 4: Allow Connections

By default, Aiven allows all connections (0.0.0.0/0). No changes needed.

---

## PART 2: Push Code to GitHub (3 min)

### Step 1: Commit Your Code

Open terminal in your project folder:

```bash
# Make sure you're in the shareAMeal directory
cd "C:\Users\SOLA\Documents\CODING\CAPSTONE\shareAMeal"

# Add all files
git add .

# Commit
git commit -m "ShareAMeal v2.0.0 - Render + Aiven ready"

# Push to GitHub
git push origin main
```

### Step 2: Verify on GitHub

1. Go to your GitHub repository
2. Verify these files are present:
   - `render.yaml`
   - `Dockerfile`
   - `scripts/migrate.js`
   - `package.json`
   - `src/` folder

---

## PART 3: Deploy on Render (7 min)

### Step 1: Create Render Account

1. Go to **https://render.com**
2. Click **Get Started**
3. Sign up with GitHub (recommended)
4. Authorize Render to access your repositories

### Step 2: Create Web Service

1. Click **+ New** ‚Üí **Web Service**
2. Connect your GitHub repository:
   - Select **shareAMeal** repository
3. Render auto-detects settings from `render.yaml`
4. Click **Apply** to use render.yaml config

### Step 3: Configure Environment Variables

Render will ask for these (from render.yaml):

**Database Connection (from Aiven):**

```
DB_HOST = <your-aiven-host>.aivencloud.com
DB_PORT = 3306
DB_NAME = defaultdb
DB_USER = avnadmin
DB_PASSWORD = <your-aiven-password>
```

**Secrets (auto-generated by Render):**

```
JWT_SECRET    = (click "Generate" - 32+ chars)
ADMIN_SECRET  = (click "Generate" - 32+ chars)
```

**Already set:**

```
NODE_ENV = production
PORT = 3000
```

### Step 4: Deploy

1. Click **Create Web Service**
2. Render will:
   - Clone your repo
   - Install dependencies (`npm ci`)
   - Build Docker image
   - Run migrations (`npm run migrate`)
   - Start server (`npm start`)
3. Wait 2-3 minutes for deployment

---

## PART 4: Test Your Deployment (2 min)

### Step 1: Get Your URL

Render provides a URL like:

```
https://shareameal-api.onrender.com
```

### Step 2: Test Health Endpoint

Open browser or use curl:

```bash
curl https://shareameal-api.onrender.com/api/health
```

**Expected response:**

```json
{
	"status": "OK",
	"message": "ShareAMeal API is running",
	"timestamp": "2026-02-24T10:30:00.000Z"
}
```

### Step 3: Test Swagger Documentation

Open in browser:

```
https://shareameal-api.onrender.com/api-docs
```

You should see the full Swagger UI with all 43 endpoints.

### Step 4: Test User Registration

```bash
curl -X POST https://shareameal-api.onrender.com/api/user \
  -H "Content-Type: application/json" \
  -d '{
    "firstName": "Test",
    "lastName": "User",
    "email": "test@example.com",
    "password": "Password123!",
    "phoneNumber": "0612345678",
    "role": "sme"
  }'
```

**Expected response (200 OK):**

```json
{
	"message": "User registered successfully",
	"user": {
		"id": 1,
		"firstName": "Test",
		"lastName": "User",
		"email": "test@example.com",
		"role": "sme"
	}
}
```

---

## ‚úÖ Deployment Complete!

Your API is now live at:

```
https://shareameal-api.onrender.com
```

**What's deployed:**

- ‚úÖ 43 API endpoints
- ‚úÖ MySQL database (1GB Aiven)
- ‚úÖ Auto-migrations on deploy
- ‚úÖ Swagger documentation
- ‚úÖ Health checks
- ‚úÖ JWT authentication

---

## üîß Configuration & Management

### Auto-Deploy Setup

**Already configured!** Every push to `main` branch triggers auto-deploy.

To disable:

1. Go to Render dashboard
2. Your service ‚Üí **Settings**
3. Uncheck **Auto-Deploy**

### Environment Variables

To update secrets:

1. Render dashboard ‚Üí Your service
2. **Environment** tab
3. Edit variables
4. Click **Save Changes**
5. Render auto-redeploys

### View Logs

```
Render Dashboard ‚Üí Your Service ‚Üí Logs
```

Real-time logs show:

- Server startup
- API requests
- Database queries
- Errors

### Database Management

**Aiven Console:**

1. Go to https://aiven.io
2. Click your service
3. Use **Query Editor** for SQL queries
4. View metrics, logs, backups

**Connect via MySQL client:**

```bash
mysql -h <aiven-host> -P 3306 -u avnadmin -p
# Enter password when prompted
```

---

## ‚ö†Ô∏è Important: Sleep Mode

**Render Free Tier sleeps after 15 minutes of inactivity.**

**Impact:**

- ‚úÖ App is still running
- ‚ö†Ô∏è First request takes 30-60 seconds to "wake up"
- ‚úÖ Subsequent requests are instant
- ‚úÖ Good for portfolio/demo projects

**To prevent sleep (requires paid plan):**

- Use external ping service (UptimeRobot)
- OR upgrade to Render paid plan ($7/month)

---

## üîç Troubleshooting

### Issue: Deployment fails at migration

**Cause:** Database connection error

**Solution:**

1. Check Aiven service is running (green status)
2. Verify DB_HOST, DB_USER, DB_PASSWORD in Render env vars
3. Check Aiven firewall (should allow 0.0.0.0/0)

### Issue: API returns 500 error

**Cause:** Missing environment variables

**Solution:**

1. Check Render logs for specific error
2. Verify all env vars are set:
   - DB_HOST, DB_USER, DB_PASSWORD, DB_NAME
   - JWT_SECRET, ADMIN_SECRET
3. Redeploy from Render dashboard

### Issue: Database connection timeout

**Cause:** Aiven service in different region

**Solution:**

1. Aiven ‚Üí Service settings
2. Check region matches Render (use US East)
3. Restart Aiven service if needed

### Issue: App takes 60s to respond

**Cause:** Normal Render free tier behavior (sleep mode)

**Solution:**

- This is expected on first request
- Subsequent requests are fast
- For instant responses, upgrade to paid or use ping service

---

## üìä Monitoring & Limits

### Render Free Tier Limits

| Resource   | Limit                   |
| ---------- | ----------------------- |
| Apps       | Unlimited               |
| Build time | 15 minutes              |
| RAM        | 512MB                   |
| CPU        | Shared                  |
| Bandwidth  | 100GB/month             |
| Hours      | 750 hours/month         |
| Sleep      | After 15 min inactivity |

### Aiven Free Tier Limits

| Resource | Limit            |
| -------- | ---------------- |
| Storage  | 1GB              |
| RAM      | 1GB              |
| CPU      | 1 CPU            |
| Tables   | Unlimited        |
| Queries  | Unlimited        |
| Backups  | 2 days retention |
| Uptime   | 99% SLA          |

### How Long Until Limits?

**For your project:**

- 50,000 users = ~200MB (well under 1GB)
- 100 simultaneous users = OK on free tier
- Typical capstone: 10-50 users max

**You're safe for:**

- ‚úÖ Capstone project
- ‚úÖ Portfolio demos
- ‚úÖ Small production apps
- ‚úÖ 1000+ test meals/users

---

## üöÄ Next Steps

### 1. Share API URL with Frontend Team

Send them:

```
Base URL: https://shareameal-api.onrender.com
Swagger:  https://shareameal-api.onrender.com/api-docs
Health:   https://shareameal-api.onrender.com/api/health
```

### 2. Create Admin Account

Use the ADMIN_SECRET from Render env vars:

```bash
curl -X POST https://shareameal-api.onrender.com/api/user \
  -H "Content-Type: application/json" \
  -H "x-admin-secret: YOUR_ADMIN_SECRET_HERE" \
  -d '{
    "firstName": "Admin",
    "lastName": "User",
    "email": "admin@shareameal.com",
    "password": "SecurePassword123!",
    "phoneNumber": "0612345678",
    "role": "admin"
  }'
```

### 3. Test All Endpoints

Use Swagger UI or Postman to test:

- User registration/login
- SME meal CRUD
- NGO meal claiming
- Sponsor operations
- Admin endpoints

### 4. Monitor First Week

Check daily:

- Render logs for errors
- Aiven storage usage
- API response times

---

## üí° Tips & Best Practices

### Security

‚úÖ **DO:**

- Keep JWT_SECRET and ADMIN_SECRET secure
- Use strong passwords for Aiven
- Enable 2FA on Render and Aiven accounts
- Review Render logs regularly

‚ùå **DON'T:**

- Commit .env files to GitHub
- Share ADMIN_SECRET publicly
- Use weak JWT secrets
- Expose database credentials

### Performance

- Accept the 30-60s wake-up time (free tier limitation)
- Use indexes in database for faster queries
- Monitor Aiven storage usage
- Optimize Swagger for production

### Cost Management

- Render and Aiven are 100% free forever for these tiers
- No surprise charges
- To scale: Upgrade Render ($7/mo) + Aiven ($10/mo) when needed

---

## üìû Support

### Render Support

- Docs: https://render.com/docs
- Community: https://community.render.com
- Email: support@render.com

### Aiven Support

- Docs: https://docs.aiven.io
- Chat: Available in console
- Email: support@aiven.io

### ShareAMeal Issues

- Check deployment logs first
- Review this guide's troubleshooting section
- Verify environment variables

---

## üéâ Success Checklist

- [ ] Aiven MySQL service running (green status)
- [ ] Code pushed to GitHub
- [ ] Render web service deployed
- [ ] Health endpoint returns 200 OK
- [ ] Swagger UI loads
- [ ] Can register a test user
- [ ] Database tables created (via migrations)
- [ ] URL shared with frontend team
- [ ] Admin account created

---

**Deployment Date:** February 24, 2026  
**Version:** 2.0.0  
**Status:** Production Ready  
**Cost:** $0/month (100% FREE)
